---
title: Rules
updated_on: Sat Sep 29 21:05:52 +0600 2012
---

h1. Автоматические проводки по правилам

YaLedger поддерживает выполнение транзакций при определённых условиях. Пример:

<pre>
@ 01/01 0.5% за снятие с карточки
{rule = !"Комиссия"}
rule Комиссия = when debit карточка with {category = "наличные"} do
  cr банковские_комиссии #1*0.05
  карточка
</pre>

В данном случае правило срабатывает после проводок, дебетующих счёт «карточка», с атрибутом category = "наличные".

После when может стоять:
* debit счёт — срабатывает после дебетовых полупроводок по заданному счёту
* credit счёт — после кредитовых полупроводок
* use счёт — после любых полупроводок по счёту

После слова with задаются условия на атрибуты полупроводок, по которым должно срабатывать правило. Слово with и атрибуты необязательны.

Правила запускаются после исполнения полупроводок. В качестве параметра @#1@ подставляется сумма полупроводки. Следует иметь ввиду, что эта сумма всегда в валюте счёта, по которому проводится полупроводка.

При исполнении правила к создаваемой транзакции добавляются атрибут rule = $name, где $name — имя правила. Если нужно гарантировать, что правило не будет срабатывать по проводкам, созданным самим же этим правилом, нужно к правилу добавить атрибут rule =! $name. Без этого в предыдущем примере с карточки будет сниматься 0.5%, потом 0.5% от этих 0.5%, и т.д. до бесконечности.