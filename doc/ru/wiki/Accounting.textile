---
title: Accounting
updated_on: Sun Oct 07 20:32:26 +0600 2012
---

h1. Используемые принципы бухгалтерского учёта

h2. Проводки и полупроводки

Входной файл состоит из записей. Каждая запись может порождать несколько транзакций. Транзакция может порождать проводку.

Проводка состоит из следующих частей:
* Кредит. Одна или несколько кредитовых полупроводок.
* Дебит. Одна или несколько дебетовых полупроводок.
* Курсовая разница. Либо отсутствует, либо представлена одной кредитовой полупроводкой, либо одной или несколькими дебетовыми полупроводками.

Полупроводка определяется следующими параметрами:
* Тип: кредитовая или дебетовая.
* Сумма. До обработки проводки суммы могут быть в произвольных валютах; после обработки проводки каждая полупроводка содержит сумму в валюте соответствующего счёта.
* Счёт.

Проводки, загруженные из входного файла, но ещё не обработанные, могут быть не согласованы (кредит не сходится с дебетом). Кроме того, они не содержат курсовой разницы. В необработанных проводках хранятся суммы в исходных валютах, которые могут не совпадать с валютами счетов.

При обработке проводки:
* Проверяется, является ли проводка согласованной (кредит == дебит).
* Если нет, то в проводку добавляется кредитовая или дебетовая полупроводка. Эта полупроводка создаётся по [[Correspondence|автоматически найденному корреспондирующему счёту]]. При поиске счёта для выполнения дебетовой полупроводки может оказаться, что для счёта необходимо выполнить [[DebitRedirect|автоматическое перенаправление части дебита]]; в таком случае вместо одной дебитовой полупроводки будет создано несколько.
* Суммы в полупроводках приводятся к валютам соответствующих счетов и округляются до точности валюты (то есть, например, до копеек).
* Если в результате округления оказалось, что одна из частей проводки — ноль, и вторая часть состоит из единственной полупроводки, то эта вторая часть тоже обнуляется.
* Вычисляется курсовая разница. В проводку добавляются соответствующие полупроводки. *NB:* курсовая разница вычисляется по текущим курсам валют. Т.к. позже курсы могут поменяться, то при подведении итогов в отчётах может образоваться дополнительная курсовая разница.

Таким образом, после обработки проводка:
* Является согласованной.
* Хранит суммы в валютах соответствующих счетов.

h2. Счета

Каждый счёт ведётся в определённой валюте. Счёт хранит:
* Историю дебетовых полупроводок (только для дебетовых и свободных счетов).
* Историю кредитовых полупроводок (только для кредитовых и свободных счетов).
* Историю балансов.

h2. Курсы валют

При обработке каждой проводки используются действующие на дату проводки курсы валют. По этим же курсам вычисляется курсовая разница.

При подведении итогов в отчётах используются курсы валют, действующие на конец отчётного периода.

В результате, если отчёт строится по длительному периоду, за который курсы валют несколько раз менялись, то может образоваться неучтённая курсовая разница (она будет видна как суммарное сальдо по корневой группе — без курсовой разницы это всегда ноль). В то же время, если отчёты строить по более мелким периодам, например, @--daily@ или @--weekly@, то в каждом из отчётов никакой неучтённой курсовой разницы не будет.
